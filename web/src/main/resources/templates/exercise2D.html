<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>姿态分析展示平台</title>
    <link rel="shortcut icon" th:href="@{/webGL/TemplateData/favicon.ico}">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script><!-- 引入vue框架 -->
    <!--<script src="https://cdn.WebRTC-Experiment.com/RecordRTC.js"></script>-->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script><!-- 引入element组件库 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css"><!-- 引入element样式 -->
    <script th:src="@{/js/common/jquery-3.3.1.min.js}"></script>
    <script th:src="@{/webGL/TemplateData/UnityProgress.js}"></script>
    <script th:src="@{/webGL/Build/UnityLoader.js}"></script>
    <link rel="stylesheet" th:href="@{/webGL/TemplateData/style.css}">

    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script><!--引入echarts组件-->
    <script src="https://cdn.jsdelivr.net/npm/v-charts/lib/index.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/v-charts/lib/style.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" th:href="@{/css/global.scss}">
    <link rel="stylesheet" th:href="@{/css/index.css}">
    <script type="text/javascript" th:src="@{/js/common/stomp.js}"></script>
    <script th:src="@{/js/components/DataBox.js}"></script><!-- 引入DataBox组件 -->
    <script th:src="@{/js/components/Common.js}"></script><!-- 引入组件 -->
    <script th:src="@{/js/components/Exercise.js}"></script><!-- 用于健身指导功能的全部组件 -->
    <script th:src="@{/js/components/Dance.js}"></script><!-- 用于动画舞蹈的全部组件 -->
</head>
<style th:inline="css">
    .header {
        width: 100%;
        height: 160px;
        padding: 0 20px;
    }
    .bg-header {
        width: 100%;
        height: 100%;
        background: url("[[@{/img/title.png}]]") no-repeat;
        background-size: 100% 100%;
    }
    .t-title {
        width: 100%;
        height: 50%;
        text-align: center;
        font-size: 2em;
        line-height: 80px;
        color: #fff;
    }
    .data-page{
        background: url("[[@{/img/background.png}]]") no-repeat;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
        height: 1100px;
        min-width: 1220px;
        background-size:100% 100%;
    }
    .data-content {
        padding-top: 20px;
        padding-bottom: 20px;
    }

    .data-main {
        width: calc(100% - 40px);
        margin-bottom: 40px;
        margin-left: 20px;
        height: 720px;}

    .main-left{
        width: 24%;
        float: left;
    }
    .main-center{
        float: left;
        width: 52%;
        padding: 0 20px 0 20px;
    }
    .main-right{
        float: left;
        width: 24%;
    }


</style>
<body>
<div class="data-page" id="exercise2D">
    <el-menu style="border-bottom: none" :default-active="'2'" class="el-menu-demo" mode="horizontal" background-color="black" text-color="#fff" active-text-color="#ffd04b">
        <el-menu-item index="1"><a th:href="@{/free}">自由锻炼</a></el-menu-item>
        <el-submenu index="2">
            <template slot="title">康复健身</template>
            <el-menu-item index="exercise2D"><a th:href="@{/realTime2D}">实时2D</a></el-menu-item>
            <el-menu-item index="exercise3D"><a href="@{/offLine3D}">离线3D</a></el-menu-item>
        </el-submenu>
    </el-menu>

    <div class="header">
        <div class="bg-header">
            <div class="t-title">Pose Estimation</div>
            <div class="t-title">实时2D康复健身</div>
        </div>
    </div>
    <div class="data-content">

        <div class="data-main">
            <div class="main-left">
                <data-box :title="'训练计划选择区'" :dheight="800">
                    <el-select v-model="trainingId" placeholder="选择用户训练计划">
                        <el-option v-for="item in trainingList" :label="item.name" :value="item.trainingId"></el-option>
                    </el-select>
                    <el-card class="box-card" v-for="item in training.moveInstanceList">
                        <el-radio v-model="moveId" :label="item.moveinstanceId">{{item.movetypeName}}</el-radio>
                        <img :src="item.moveImage" height="100%" width="100%">
                        <!--<div v-for="(value, key) in item" class="text item">-->
                            <!--{{key}} : {{value}}-->
                        <!--</div>-->
                    </el-card>
                </data-box>
            </div>
            <div class="main-center">
                <data-box :title="'动作参数展示区'" :dheight="300">
                    <el-card class="box-card">
                        <img :src="move.motionImage" height="100%">
                        <div v-for="item in move.motionInstanceList" class="text item">
                            <div v-for="(value, key) in item" class="text item">
                                {{key}} : {{value}}
                            </div>
                        </div>
                    </el-card>
                </data-box>
                <data-box :title="'实时Unity3D动画'" :dheight="500" :icon="'account'" :boxb="false">
                    <div>
                        <div id="gameContainer" style="width: 100%; height: 100%"></div>
                    </div>
                </data-box>
            </div>
            <div class="main-right">
                <data-box :title="''" :dheight="800">
                    <data-box :title="'动作指导视频'" :dheight="400" :boxb="false">
                    </data-box>
                    <data-box :title="'摄像头实时输出画面'" :dheight="400" :boxb="false">
                        <video style="width: 100%; height: 100%" autoplay></video>
                        <canvas id="targetCanvas" width="400px" height="300px" style="visibility:hidden;"></canvas>
                    </data-box>
                </data-box>

            </div>
        </div>
    </div>
</div>

<script>

    var destination, login, passcode, userToken;
    url = "ws://10.103.238.165:61614";
    destination = "/queue/video";
    login = "admin";
    passcode = "password";
    userToken = "123";

    var pointMapping = { //关节点映射表，由于识别关节点和Unity关节点不同，因此需要进行转换
        "0": 10,
        "1": 8,
        "2": 11,
        "3": 12,
        "4": 13,
        "5": 14,
        "6": 15,
        "7": 13,
        "8": 4,
        "9": 5,
        "10": 6,
        "11": 1,
        "12": 2,
        "13": 16
    };
    // var client = Stomp.client(url); TODO 暂时关闭

    var stompOnMessage = function (message) {
        let jsonData = JSON.parse(message.body); //接收数据JSON示例：{'image':'', 'poseResultParsed':''}
        if (jsonData.poseResultParsed) {
            let poseArray = JSON.parse(jsonData.poseResultParsed); //单帧二维坐标点数据
            // for(let i = 0; i < poseArray.length;i ++){ //TODO 多人场景？
            //
            // }

            let singlePerson = poseArray[0]; //singlePerson是个JSON对象，key为关节点index值，value为横纵坐标以及置信度所组成的JSON对象

            let singleArray = [];
            for (let key in singlePerson) {
                app.poseData[key] = singlePerson[key].c; //填充置信度信息
                if (pointMapping[key]) { //进行映射之后的关节点index，如果在定义范围内则进行写入（注意14以后的坐标点都没有用到）
                    singleArray.push(pointMapping[key]);
                    singleArray.push(singlePerson[key].x - 150);
                    singleArray.push(400 - singlePerson[key].y);

                }
            }
            if (singleArray) { //数据不为空
                console.log(singleArray.toString());
                app.gameInstance.SendMessage("Philip", "GetPose", singleArray.toString()); //调用Unity内部方法，将姿态数据传入
            }
        }
        if(jsonData.image){
            let img = document.getElementById("targetImg");
            img.src = jsonData.image;
        }

    };

    var stompOnError = function (error) {
        alert(error);
        console.log("Stomp连接出错！" + error);
    };

    // // the client is notified when it is connected to the server. TODO 暂时关闭
    // client.connect(login, passcode, function (frame) {
    //     client.subscribe("/user/" + userToken + "/video", stompOnMessage);
    // }, stompOnError);


    var exercise2D = new Vue({
        el:'#exercise2D',
        data:{
            gameInstance:'',
            sendMsg:{
                userToken:'123',
                image:'',
                task:1
            },
            myTimer:'', //定时器
            poseData:{},
            trainingList:[
                {
                    "trainingId": 74,
                    "userId": 4,
                    "name": "cecilia-01112018-1",
                    "dayofweek": "1,2,3,4,5,6,7,",
                    "starttime": "2017-12-31T16:00:00.000+0000",
                    "endtime": "2018-02-27T16:00:00.000+0000",
                    "defaultdays": null,
                    "parent": 73,
                    "docUserId": 3,
                    "repeatPerDay": "1",
                    "visibility": 1,
                    "moveInstanceList": [
                        {
                            "moveinstanceId": 185,
                            "movetypeName": "坐位伸膝-右",
                            "movesetId": 74,
                            "movetypeId": 25,
                            "groupsPerRepeat": 3,
                            "timesPerGroup": 3,
                            "restBetweenGroup": 30,
                            "rhythm": "1,1,1",
                            "sequence": 1,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 243,
                                    "movetypeinstanceId": 185,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 70,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 186,
                            "movetypeName": "仰卧屈髋屈膝-右",
                            "movesetId": 74,
                            "movetypeId": 26,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 3,
                            "restBetweenGroup": 60,
                            "rhythm": "5,1,1",
                            "sequence": 2,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 244,
                                    "movetypeinstanceId": 186,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 40,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 187,
                            "movetypeName": "单腿下蹲-半蹲-右",
                            "movesetId": 74,
                            "movetypeId": 24,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 3,
                            "restBetweenGroup": 60,
                            "rhythm": "1,3,1",
                            "sequence": 3,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 245,
                                    "movetypeinstanceId": 187,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        }
                    ]
                },
                {
                    "trainingId": 94,
                    "userId": 4,
                    "name": "cecilia-01172018-1",
                    "dayofweek": "1,2,3,4,5,6,7,",
                    "starttime": "2017-12-31T16:00:00.000+0000",
                    "endtime": "2018-01-30T16:00:00.000+0000",
                    "defaultdays": null,
                    "parent": 93,
                    "docUserId": 3,
                    "repeatPerDay": "1",
                    "visibility": 1,
                    "moveInstanceList": [
                        {
                            "moveinstanceId": 202,
                            "movetypeName": "双腿下蹲",
                            "movesetId": 89,
                            "movetypeId": 42,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 4,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 1,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 261,
                                    "movetypeinstanceId": 202,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                },
                                {
                                    "jointmotioninstanceId": 262,
                                    "movetypeinstanceId": 202,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        }
                    ]
                },
                {
                    "trainingId": 98,
                    "userId": 4,
                    "name": "ceilia-01192018-1",
                    "dayofweek": "1,2,3,4,5,6,7,",
                    "starttime": "2017-12-31T16:00:00.000+0000",
                    "endtime": "2018-02-14T16:00:00.000+0000",
                    "defaultdays": null,
                    "parent": 97,
                    "docUserId": 3,
                    "repeatPerDay": "1",
                    "visibility": 1,
                    "moveInstanceList": [
                        {
                            "moveinstanceId": 207,
                            "movetypeName": "双腿下蹲",
                            "movesetId": 92,
                            "movetypeId": 42,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 3,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 1,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 269,
                                    "movetypeinstanceId": 207,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 40,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                },
                                {
                                    "jointmotioninstanceId": 270,
                                    "movetypeinstanceId": 207,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 40,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 208,
                            "movetypeName": "踝屈伸",
                            "movesetId": 92,
                            "movetypeId": 51,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 3,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 2,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 271,
                                    "movetypeinstanceId": 208,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 70,
                                    "bone1": 33,
                                    "bone2": -2,
                                    "sign": null
                                },
                                {
                                    "jointmotioninstanceId": 272,
                                    "movetypeinstanceId": 208,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 70,
                                    "bone1": 34,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 209,
                            "movetypeName": "坐位伸膝-左",
                            "movesetId": 92,
                            "movetypeId": 52,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 3,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 3,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 273,
                                    "movetypeinstanceId": 209,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 80,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        }
                    ]
                },
                {
                    "trainingId": 100,
                    "userId": 4,
                    "name": "cyx-test-20180119",
                    "dayofweek": "1,2,3,4,5,6,7,",
                    "starttime": "2017-10-30T16:00:00.000+0000",
                    "endtime": "2018-01-30T16:00:00.000+0000",
                    "defaultdays": null,
                    "parent": 99,
                    "docUserId": 3,
                    "repeatPerDay": "1",
                    "visibility": 1,
                    "moveInstanceList": [
                        {
                            "moveinstanceId": 211,
                            "movetypeName": "单腿下蹲-半蹲-右",
                            "movesetId": 94,
                            "movetypeId": 24,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 1,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 275,
                                    "movetypeinstanceId": 211,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 0,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        }
                    ]
                },
                {
                    "trainingId": 102,
                    "userId": 4,
                    "name": "cecilia-01192018-2",
                    "dayofweek": "1,2,3,4,5,6,7,",
                    "starttime": "2017-12-31T16:00:00.000+0000",
                    "endtime": "2018-01-30T16:00:00.000+0000",
                    "defaultdays": null,
                    "parent": 101,
                    "docUserId": 3,
                    "repeatPerDay": "1",
                    "visibility": 1,
                    "moveInstanceList": [
                        {
                            "moveinstanceId": 221,
                            "movetypeName": "仰卧屈髋屈膝-左",
                            "movesetId": 96,
                            "movetypeId": 53,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 1,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 285,
                                    "movetypeinstanceId": 221,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 222,
                            "movetypeName": "弹力带牵拉被动屈膝-右",
                            "movesetId": 96,
                            "movetypeId": 54,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 2,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 286,
                                    "movetypeinstanceId": 222,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 68,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 223,
                            "movetypeName": "弹力带牵拉被动屈膝-左",
                            "movesetId": 96,
                            "movetypeId": 55,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 3,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 287,
                                    "movetypeinstanceId": 223,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 224,
                            "movetypeName": "被动屈膝-右",
                            "movesetId": 96,
                            "movetypeId": 56,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 4,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 288,
                                    "movetypeinstanceId": 224,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 225,
                            "movetypeName": "被动屈膝-左",
                            "movesetId": 96,
                            "movetypeId": 57,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 5,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 289,
                                    "movetypeinstanceId": 225,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 226,
                            "movetypeName": "仰卧举腿(屈髋)-右",
                            "movesetId": 96,
                            "movetypeId": 58,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 6,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 290,
                                    "movetypeinstanceId": 226,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 70,
                                    "bone1": 20,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 227,
                            "movetypeName": "仰卧举腿(屈髋)-左",
                            "movesetId": 96,
                            "movetypeId": 59,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 7,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 291,
                                    "movetypeinstanceId": 227,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 70,
                                    "bone1": 22,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 228,
                            "movetypeName": "俯卧举腿(伸髋)-右",
                            "movesetId": 96,
                            "movetypeId": 60,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 8,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 292,
                                    "movetypeinstanceId": 228,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 70,
                                    "bone1": 20,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 229,
                            "movetypeName": "俯卧举腿(伸髋)-左",
                            "movesetId": 96,
                            "movetypeId": 61,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 9,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 293,
                                    "movetypeinstanceId": 229,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 70,
                                    "bone1": 22,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        }
                    ]
                },
                {
                    "trainingId": 104,
                    "userId": 4,
                    "name": "cecilia-01192018-3",
                    "dayofweek": "1,2,3,4,5,6,7,",
                    "starttime": "2017-12-31T16:00:00.000+0000",
                    "endtime": "2018-02-01T16:00:00.000+0000",
                    "defaultdays": 90,
                    "parent": 103,
                    "docUserId": 3,
                    "repeatPerDay": "1",
                    "visibility": 1,
                    "moveInstanceList": [
                        {
                            "moveinstanceId": 235,
                            "movetypeName": "站位屈膝-右",
                            "movesetId": 98,
                            "movetypeId": 62,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 1,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 299,
                                    "movetypeinstanceId": 235,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 70,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 236,
                            "movetypeName": "站位屈膝-左",
                            "movesetId": 98,
                            "movetypeId": 63,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 2,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 300,
                                    "movetypeinstanceId": 236,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 70,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 237,
                            "movetypeName": "俯卧屈膝-右",
                            "movesetId": 98,
                            "movetypeId": 64,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 3,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 301,
                                    "movetypeinstanceId": 237,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 70,
                                    "bone1": 19,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 238,
                            "movetypeName": "俯卧屈膝-左",
                            "movesetId": 98,
                            "movetypeId": 65,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 4,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 302,
                                    "movetypeinstanceId": 238,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 70,
                                    "bone1": 21,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 239,
                            "movetypeName": "单腿下蹲-半蹲-左",
                            "movesetId": 98,
                            "movetypeId": 66,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 5,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 303,
                                    "movetypeinstanceId": 239,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 70,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        }
                    ]
                },
                {
                    "trainingId": 116,
                    "userId": 4,
                    "name": "cecilia-01262018-1",
                    "dayofweek": "1,2,3,4,5,6,7,",
                    "starttime": "2017-12-31T16:00:00.000+0000",
                    "endtime": "2018-03-30T16:00:00.000+0000",
                    "defaultdays": null,
                    "parent": 115,
                    "docUserId": 3,
                    "repeatPerDay": "1",
                    "visibility": 1,
                    "moveInstanceList": [
                        {
                            "moveinstanceId": 317,
                            "movetypeName": "坐位伸膝-右",
                            "movesetId": 110,
                            "movetypeId": 25,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 1,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 380,
                                    "movetypeinstanceId": 317,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 90,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 318,
                            "movetypeName": "仰卧屈髋屈膝-右",
                            "movesetId": 110,
                            "movetypeId": 26,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 2,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 381,
                                    "movetypeinstanceId": 318,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 319,
                            "movetypeName": "单腿下蹲-半蹲-右",
                            "movesetId": 110,
                            "movetypeId": 24,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 3,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 382,
                                    "movetypeinstanceId": 319,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 320,
                            "movetypeName": "坐位伸膝-左",
                            "movesetId": 110,
                            "movetypeId": 52,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 4,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 383,
                                    "movetypeinstanceId": 320,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 90,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 321,
                            "movetypeName": "仰卧屈髋屈膝-左",
                            "movesetId": 110,
                            "movetypeId": 53,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 5,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 384,
                                    "movetypeinstanceId": 321,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 322,
                            "movetypeName": "弹力带牵拉被动屈膝-右",
                            "movesetId": 110,
                            "movetypeId": 54,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 6,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 385,
                                    "movetypeinstanceId": 322,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 323,
                            "movetypeName": "弹力带牵拉被动屈膝-左",
                            "movesetId": 110,
                            "movetypeId": 55,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 7,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 386,
                                    "movetypeinstanceId": 323,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 324,
                            "movetypeName": "被动屈膝-右",
                            "movesetId": 110,
                            "movetypeId": 56,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 8,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 387,
                                    "movetypeinstanceId": 324,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 325,
                            "movetypeName": "被动屈膝-左",
                            "movesetId": 110,
                            "movetypeId": 57,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 9,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 388,
                                    "movetypeinstanceId": 325,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 326,
                            "movetypeName": "仰卧举腿(屈髋)-右",
                            "movesetId": 110,
                            "movetypeId": 58,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 10,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 389,
                                    "movetypeinstanceId": 326,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 30,
                                    "bone1": 20,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 327,
                            "movetypeName": "仰卧举腿(屈髋)-左",
                            "movesetId": 110,
                            "movetypeId": 59,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 11,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 390,
                                    "movetypeinstanceId": 327,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 30,
                                    "bone1": 22,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 328,
                            "movetypeName": "俯卧举腿(伸髋)-右",
                            "movesetId": 110,
                            "movetypeId": 60,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 12,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 391,
                                    "movetypeinstanceId": 328,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 30,
                                    "bone1": 20,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 329,
                            "movetypeName": "俯卧举腿(伸髋)-左",
                            "movesetId": 110,
                            "movetypeId": 61,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 13,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 392,
                                    "movetypeinstanceId": 329,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 30,
                                    "bone1": 22,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 330,
                            "movetypeName": "站位屈膝-右",
                            "movesetId": 110,
                            "movetypeId": 62,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 14,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 393,
                                    "movetypeinstanceId": 330,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 90,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 331,
                            "movetypeName": "站位屈膝-左",
                            "movesetId": 110,
                            "movetypeId": 63,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 15,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 394,
                                    "movetypeinstanceId": 331,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 90,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 332,
                            "movetypeName": "俯卧屈膝-右",
                            "movesetId": 110,
                            "movetypeId": 64,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 16,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 395,
                                    "movetypeinstanceId": 332,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 90,
                                    "bone1": 19,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 333,
                            "movetypeName": "俯卧屈膝-左",
                            "movesetId": 110,
                            "movetypeId": 65,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 17,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 396,
                                    "movetypeinstanceId": 333,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 0,
                                    "bone1": 21,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        }
                    ]
                },
                {
                    "trainingId": 118,
                    "userId": 4,
                    "name": "cecilia-01262018-1",
                    "dayofweek": "1,2,3,4,5,6,7,",
                    "starttime": "2017-12-31T16:00:00.000+0000",
                    "endtime": "2018-03-30T16:00:00.000+0000",
                    "defaultdays": null,
                    "parent": 115,
                    "docUserId": 3,
                    "repeatPerDay": "1",
                    "visibility": 1,
                    "moveInstanceList": [
                        {
                            "moveinstanceId": 351,
                            "movetypeName": "坐位伸膝-右",
                            "movesetId": 112,
                            "movetypeId": 25,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 1,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 414,
                                    "movetypeinstanceId": 351,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 90,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 352,
                            "movetypeName": "仰卧屈髋屈膝-右",
                            "movesetId": 112,
                            "movetypeId": 26,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 2,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 415,
                                    "movetypeinstanceId": 352,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 353,
                            "movetypeName": "单腿下蹲-半蹲-右",
                            "movesetId": 112,
                            "movetypeId": 24,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 3,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 416,
                                    "movetypeinstanceId": 353,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 354,
                            "movetypeName": "坐位伸膝-左",
                            "movesetId": 112,
                            "movetypeId": 52,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 4,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 417,
                                    "movetypeinstanceId": 354,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 90,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 355,
                            "movetypeName": "仰卧屈髋屈膝-左",
                            "movesetId": 112,
                            "movetypeId": 53,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 5,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 418,
                                    "movetypeinstanceId": 355,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 356,
                            "movetypeName": "弹力带牵拉被动屈膝-右",
                            "movesetId": 112,
                            "movetypeId": 54,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 6,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 419,
                                    "movetypeinstanceId": 356,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 357,
                            "movetypeName": "弹力带牵拉被动屈膝-左",
                            "movesetId": 112,
                            "movetypeId": 55,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 7,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 420,
                                    "movetypeinstanceId": 357,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 358,
                            "movetypeName": "被动屈膝-右",
                            "movesetId": 112,
                            "movetypeId": 56,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 8,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 421,
                                    "movetypeinstanceId": 358,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 359,
                            "movetypeName": "被动屈膝-左",
                            "movesetId": 112,
                            "movetypeId": 57,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 9,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 422,
                                    "movetypeinstanceId": 359,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 60,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 360,
                            "movetypeName": "仰卧举腿(屈髋)-右",
                            "movesetId": 112,
                            "movetypeId": 58,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 10,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 423,
                                    "movetypeinstanceId": 360,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 30,
                                    "bone1": 20,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 361,
                            "movetypeName": "仰卧举腿(屈髋)-左",
                            "movesetId": 112,
                            "movetypeId": 59,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 11,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 424,
                                    "movetypeinstanceId": 361,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 30,
                                    "bone1": 22,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 362,
                            "movetypeName": "俯卧举腿(伸髋)-右",
                            "movesetId": 112,
                            "movetypeId": 60,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 12,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 425,
                                    "movetypeinstanceId": 362,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 30,
                                    "bone1": 20,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 363,
                            "movetypeName": "俯卧举腿(伸髋)-左",
                            "movesetId": 112,
                            "movetypeId": 61,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 13,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 426,
                                    "movetypeinstanceId": 363,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 30,
                                    "bone1": 22,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 364,
                            "movetypeName": "站位屈膝-右",
                            "movesetId": 112,
                            "movetypeId": 62,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 14,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 427,
                                    "movetypeinstanceId": 364,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 90,
                                    "bone1": 19,
                                    "bone2": 20,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 365,
                            "movetypeName": "站位屈膝-左",
                            "movesetId": 112,
                            "movetypeId": 63,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 15,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 428,
                                    "movetypeinstanceId": 365,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 90,
                                    "bone1": 21,
                                    "bone2": 22,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 366,
                            "movetypeName": "俯卧屈膝-右",
                            "movesetId": 112,
                            "movetypeId": 64,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 16,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 429,
                                    "movetypeinstanceId": 366,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 90,
                                    "bone1": 19,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        },
                        {
                            "moveinstanceId": 367,
                            "movetypeName": "俯卧屈膝-左",
                            "movesetId": 112,
                            "movetypeId": 65,
                            "groupsPerRepeat": 1,
                            "timesPerGroup": 1,
                            "restBetweenGroup": 60,
                            "rhythm": "1,1,1",
                            "sequence": 17,
                            "leftorright": null,
                            "motionInstanceList": [
                                {
                                    "jointmotioninstanceId": 430,
                                    "movetypeinstanceId": 367,
                                    "jointmotionName": "undefined",
                                    "rotateAngle": 0,
                                    "bone1": 21,
                                    "bone2": -2,
                                    "sign": null
                                }
                            ]
                        }
                    ]
                }
            ],
            trainingId:'', //用户选择的训练计划ID
            training:{}, //用户选择的训练计划
            moveId:'', //用户选择的动作ID
            move:{} //用户选择的动作


        },
        mounted: function(){
            this.getTrainingPlan();
            // this.gameInstance = UnityLoader.instantiate("gameContainer", "${pageContext.request.contextPath}/webGL/Build/Receiver2Dv5.json", {onProgress: UnityProgress});

            this.initCamera(); //初始化摄像头
            // this.initWebSocket(); //初始化WebSocket


        },
        watch:{
            trainingId: function (newVal) { //筛选出符合条件的训练计划
                this.training = this.trainingList.filter(function (item) {
                     return item.trainingId === newVal;
                })[0];
            },
            moveId: function(newVal) { //监听用户选择的动作
                this.move = this.training.moveInstanceList.filter(function(item){
                    return item.moveinstanceId === newVal;
                })[0];
            }
        },
        methods:{
            getTrainingPlan:function(){ //拉取该用户的所有训练计划
                let _this = this;
                $.ajax({
                    url: 'http://localhost:8080/VisionPlatform_web/api/getTraining',
                    dataType: 'json',
                    contentType : 'application/json',
                    data: JSON.stringify({
                        userId: 4
                    }),
                    type: 'POST',
                    success: function (data) {
                        _this.trainingList = data.map;
                    },
                    error: function () {
                        console.log("用户训练计划拉取失败！")
                    }
                });
            },
            initCamera:function(){
                let _this = this;
                let constraints = { video: true };
                let video = document.querySelector('video');
                navigator.mediaDevices.getUserMedia(constraints)
                    .then(function(mediaStream) {
                        video.srcObject = mediaStream;
                    })
                    .catch(function(err) { console.log(err.name + ": " + err.message); }); // 总是在最后检查错误
            },
            transImage: function (video) {
//                console.log("进入transImage方法");
                let _this = this;
                let canvas = document.getElementById('targetCanvas');
//                let scale = 1; //缩放比例
//                canvas.width = video.videoWidth * scale;
//                canvas.height = video.videoHeight * scale;
                canvas.getContext('2d').drawImage(video, 0, 0, 400,300);
                let image = canvas.toDataURL('image/jpeg');
                if (image != null) {
                    client.send(destination, {'user-token': userToken, 'task': 0x01}, image); //发送消息
                    // _this.sendMsg.image = image; //填充base64编码后的视频帧
                    // this.socket.send(JSON.stringify(_this.sendMsg)); //通过WebSocket发送到后台
                    // console.log(image);
                }
            },
            change:function(){ //控制WebGL激活/禁用脚本
                this.gameInstance.SendMessage("Philip", "ChangeState");
                console.log("脚本状态改变！");
                this.button.enable = !this.button.enable;
                if(this.button.enable){
                    this.button.buttonType = 'danger';

                }else{
                    this.button.buttonType = 'success';
                }
            },
            initWebSocket: function () {
                if(window.WebSocket){
                    console.log("初始化WebSocket！");
                    // this.socket = new WebSocket('ws://localhost:8080/PoseEstimation/unityWebSocket');
                    this.socket = new WebSocket('ws://localhost:8080/PoseEstimation/webSocket/' + this.sendMsg.userToken); //123为用户ID
                    this.socket.onopen = this.onOpen;
                    this.socket.onmessage = this.onMessage;
                    this.socket.onerror = this.onError;
                    this.socket.onclose = this.onClose;
                }else {
                    console.log("不支持WebSocket！");
                }
            },
            onOpen: function () {
                let _this = this;
                console.log("WebSocket连接成功!");
                setInterval(function(){
                    _this.transImage(document.querySelector('video'));
                }, 50); //50ms发送一次
                // this.socket.binaryType = "arraybuffer"; //设置发送消息类型
                // this.socket.send("Hello!");
            },
            onMessage: function(event){
                if(event.data){
                    console.log("接收到来自后台的消息：" + event.data);
                    gameInstance.SendMessage("Philip", "GetPose", event.data); //调用Unity内部方法，将姿态数据传入
                }
            },
            onError: function(){
                console.log("WebSocket连接发生错误！");
            },
            onClose: function(){
                console.log("WebSocket关闭！");
            },
            changeTrans:function () { //按钮调用，用于启动图像传输
                let _this = this;
                _this.button2.enable = !_this.button2.enable;
                if(_this.button2.enable){
                    _this.button2.buttonType = 'danger';
                    _this.myTimer = setInterval(function(){
                        _this.transImage(document.querySelector('video'));
                    }, 100); //50ms发送一次
                } else {
                    clearInterval(_this.myTimer);
                    _this.button2.buttonType = 'success';
                }
            },
        },
        components:{
            dataBox:DataBox,
            dataBoard: DataBoard, //用于健身指导的数据面板（左）
            record:Record, //用于动画舞蹈的录制面板（左）
            exeIntro:ExeIntro, //健身指导介绍（底部）
            danceIntro: DanceIntro //动画舞蹈介绍（底部）
        }
    })
</script>
</body>
</html>
